// AdminController.ts iÃ§in patch
// 977-986 satÄ±rlarÄ± arasÄ±ndaki kÄ±smÄ± deÄŸiÅŸtir

// ESKÄ° KOD:
/*
      listing_images: (listing as any).listing_images?.map((img: any) => {
        console.log('ğŸ–¼ï¸ Processing image:', {url: img.url, sort_order: img.sort_order});
        return {
          id: img.id,
          url: img.url,  // Frontend bunu bekliyor
          image_url: img.url,  // Alternatif
          sort_order: img.sort_order,
          order: img.sort_order  // Alternatif
        };
      }) || [],
*/

// YENÄ° KOD:
      listing_images: (() => {
        // Ã–nce listing_images tablosundan kontrol et
        if ((listing as any).listing_images && (listing as any).listing_images.length > 0) {
          console.log('ğŸ–¼ï¸ Using images from listing_images table');
          return (listing as any).listing_images.map((img: any) => {
            console.log('ğŸ–¼ï¸ Processing image:', {url: img.url, sort_order: img.sort_order});
            return {
              id: img.id,
              url: img.url,
              image_url: img.url,
              sort_order: img.sort_order,
              order: img.sort_order
            };
          });
        }
        
        // EÄŸer listing_images tablosunda veri yoksa, listings.images alanÄ±ndan al
        if (listing.images) {
          console.log('ğŸ–¼ï¸ Using images from listings.images field');
          try {
            const parsedImages = Array.isArray(listing.images) ? listing.images : JSON.parse(listing.images as string);
            return parsedImages.map((img: string, index: number) => {
              console.log('ğŸ–¼ï¸ Processing inline image:', {index, url: img.substring(0, 50) + '...'});
              return {
                id: `inline_${index}`,
                url: img,
                image_url: img,
                sort_order: index,
                order: index
              };
            });
          } catch (parseError) {
            console.error('ğŸ–¼ï¸ Error parsing images JSON:', parseError);
            return [];
          }
        }
        
        console.log('ğŸ–¼ï¸ No images found');
        return [];
      })(),
